# Anti-Ban: –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞

## üî¥ –î–í–ï –ì–õ–ê–í–ù–´–ï –ü–†–ò–ß–ò–ù–´ –ë–ê–ù–û–í

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞ (DrissionPage)
```python
# ‚ùå –ù–ê–® –ö–û–î - AWS –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç –∫–∞–∫ –±–æ—Ç–∞
page = ChromiumPage()
page.ele("@type=email").input(email)
page.ele("@type=password").input(password)
```

```rust
// ‚úÖ –ò–• –ö–û–î - —Ä–µ–∞–ª—å–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä
std::process::Command::new("chrome.exe")
    .args(&["--incognito", url])
    .spawn()
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ –°–ê–ú!
```

### 2. –ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ quota –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
```python
# ‚ùå –ù–ê–® –ö–û–î - —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç –±–∞–Ω
def register(email, password):
    token = exchange_code(code)
    quota = get_quota(token)  # ‚Üê –ë–ê–ù!
    return token
```

```rust
// ‚úÖ –ò–• –ö–û–î - –ù–ï –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Å—Ä–∞–∑—É
fn register(email, password) -> Token {
    let token = exchange_code(code);
    // –ù–ï –≤—ã–∑—ã–≤–∞—é—Ç get_quota!
    return token;
}
```

---

## ‚úÖ –ß–¢–û –î–ï–õ–ê–¢–¨ –°–†–û–ß–ù–û

### –®–∞–≥ 1: –£–±—Ä–∞—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (30 –º–∏–Ω—É—Ç)

**–§–∞–π–ª:** `autoreg/registration/register.py`
```python
# –£–¥–∞–ª–∏—Ç—å —ç—Ç–∏ —Å—Ç—Ä–æ–∫–∏:
quota = self.token_service.get_quota(token)
logger.info(f"Quota: {quota}")
```

**–§–∞–π–ª:** `src/providers/AccountsProvider.ts`
```typescript
// –£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Å—Ç—Ä–æ–∫—É:
await this.checkAccountHealth(email);
```

### –®–∞–≥ 2: WebView OAuth (2-3 —á–∞—Å–∞)

**–°–æ–∑–¥–∞—Ç—å:** `autoreg/registration/oauth_server.py`
- –õ–æ–∫–∞–ª—å–Ω—ã–π HTTP —Å–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É 43210
- –õ–æ–≤–∏—Ç OAuth callback —Å `code`

**–°–æ–∑–¥–∞—Ç—å:** `autoreg/registration/webview_auth.py`
- –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä (Chrome/Edge)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ª–æ–≥–∏–Ω–∏—Ç—Å—è –≤—Ä—É—á–Ω—É—é
- –û–±–º–µ–Ω–∏–≤–∞–µ—Ç `code` –Ω–∞ —Ç–æ–∫–µ–Ω—ã
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ë–ï–ó –ø—Ä–æ–≤–µ—Ä–æ–∫

**–î–æ–±–∞–≤–∏—Ç—å –≤:** `autoreg/cli.py`
```bash
python -m autoreg.cli webview-login --email test@gmail.com
```

### –®–∞–≥ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (1 —á–∞—Å)
- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å 5-10 –∞–∫–∫–∞—É–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ WebView
- –ü–æ–¥–æ–∂–¥–∞—Ç—å 24 —á–∞—Å–∞
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ban rate

---

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ |
|---------|-----|-------|
| Ban rate | 80-90% | <10% |
| –í—Ä–µ–º—è –¥–æ –±–∞–Ω–∞ | –°—Ä–∞–∑—É | –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å |
| –ú–µ—Ç–æ–¥ | DrissionPage | –†–µ–∞–ª—å–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ quota | –°—Ä–∞–∑—É | –ü–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é |

---

## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ò—Ö OAuth Flow (Social Auth)
```
1. –û—Ç–∫—Ä—ã—Ç—å –±—Ä–∞—É–∑–µ—Ä:
   https://prod.us-east-1.auth.desktop.kiro.dev/login
     ?idp=Google
     &redirect_uri=http://127.0.0.1:43210/oauth/callback
     &code_challenge=...
     &state=...

2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ª–æ–≥–∏–Ω–∏—Ç—Å—è –≤—Ä—É—á–Ω—É—é

3. Callback:
   http://127.0.0.1:43210/oauth/callback?code=...&state=...

4. Exchange code:
   POST https://prod.us-east-1.auth.desktop.kiro.dev/oauth/token
   {
     "code": "...",
     "code_verifier": "...",
     "redirect_uri": "..."
   }

5. Response:
   {
     "accessToken": "...",
     "refreshToken": "...",
     "expiresIn": 3600,
     "profileArn": "...",
     "csrfToken": "..."
   }

6. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω—ã –ë–ï–ó –ø—Ä–æ–≤–µ—Ä–æ–∫!
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ quota (—Ç–æ–ª—å–∫–æ –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é)
```
GET https://codewhisperer.us-east-1.amazonaws.com/getUsageLimits
  ?isEmailRequired=true
  &origin=AI_EDITOR
  &profileArn=arn:aws:codewhisperer:us-east-1:699475941385:profile/EHGA3GRVQMUK
Headers:
  Authorization: Bearer <access_token>
```

**–ö–æ–≥–¥–∞ –≤—ã–∑—ã–≤–∞—Ç—å:**
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª "Refresh"
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–∫–ª—é—á–∏–ª—Å—è –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç
- ‚úÖ –ü—Ä–æ—à–ª–æ 24+ —á–∞—Å–æ–≤ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
- ‚ùå –ù–ï —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏!

---

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã

### üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ (–¥–µ–ª–∞—Ç—å –°–ï–ô–ß–ê–°)
1. –£–±—Ä–∞—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ quota
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å WebView OAuth —Å —Ä–µ–∞–ª—å–Ω—ã–º –±—Ä–∞—É–∑–µ—Ä–æ–º

### üü° –í–∞–∂–Ω–æ (–¥–µ–ª–∞—Ç—å –ü–û–¢–û–ú)
3. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–∫—Å–∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É
4. Delayed quota checks (—Ä–∞–∑ –≤ 24 —á–∞—Å–∞)

### üü¢ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–µ—Å–ª–∏ –Ω–µ –ø–æ–º–æ–∂–µ—Ç)
5. KiroWebPortalService API —Å CBOR encoding

---

## üìù –ß–µ–∫–ª–∏—Å—Ç

- [ ] –£–¥–∞–ª–∏—Ç—å `get_quota()` –∏–∑ `register.py`
- [ ] –£–¥–∞–ª–∏—Ç—å `checkAccountHealth()` –∏–∑ `AccountsProvider.ts`
- [ ] –°–æ–∑–¥–∞—Ç—å `oauth_server.py`
- [ ] –°–æ–∑–¥–∞—Ç—å `webview_auth.py`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É `webview-login` –≤ CLI
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ 5 –∞–∫–∫–∞—É–Ω—Ç–∞—Ö
- [ ] –ü–æ–¥–æ–∂–¥–∞—Ç—å 24 —á–∞—Å–∞
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ban rate
- [ ] –ï—Å–ª–∏ <10% ban rate - SUCCESS!
- [ ] –ï—Å–ª–∏ >10% ban rate - –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–∫—Å–∏ (—à–∞–≥ 3)

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# 1. –£–±—Ä–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å autoreg/registration/register.py
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å src/providers/AccountsProvider.ts

# 2. –°–æ–∑–¥–∞—Ç—å OAuth server –∏ WebView auth
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –∏–∑ docs/IMPLEMENTATION_PLAN.md

# 3. –¢–µ—Å—Ç
python -m autoreg.cli webview-login --email test@gmail.com

# 4. –ü–æ–¥–æ–∂–¥–∞—Ç—å 24 —á–∞—Å–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å
python -m autoreg.cli check-account --email test@gmail.com
```

---

## üí° –ö–ª—é—á–µ–≤—ã–µ –∏–Ω—Å–∞–π—Ç—ã –∏–∑ –∏—Ö –∫–æ–¥–∞

1. **–û–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –¢–û–¢ –ñ–ï API** (`codewhisperer.us-east-1.amazonaws.com`)
2. **–ù–æ –ù–ï –≤—ã–∑—ã–≤–∞—é—Ç –µ–≥–æ —Å—Ä–∞–∑—É** –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
3. **–†–µ–∞–ª—å–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä** –≤–º–µ—Å—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
4. **–†—É—á–Ω–æ–π –≤–≤–æ–¥** –≤–º–µ—Å—Ç–æ `.input()` –∏ `.click()`
5. **–ü—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–ª—å–∫–æ –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–í—ã–≤–æ–¥:** –ü—Ä–æ–±–ª–µ–º–∞ –Ω–µ –≤ API, –∞ –≤ –ü–ê–¢–¢–ï–†–ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è!
